package me.moomoo.anarchyexploitfixes.utils;

import me.moomoo.anarchyexploitfixes.AnarchyExploitFixes;
import org.bukkit.Location;
import org.bukkit.World;
import org.bukkit.entity.Player;

import java.awt.*;

import static java.lang.String.format;
import static org.apache.commons.math3.util.FastMath.*;

public class ElytraUtils {

    public static boolean canBurst(double burstTPS) {
        return AnarchyExploitFixes.getTPSofLastSecond() > burstTPS;
    }

    public static double blocksPerTick(Location from, Location to) {
        return hypot(
                to.getX() - from.getX(),
                to.getZ() - from.getZ()
        );
    }

    public static String speed(double flySpeed) {
        return format("%.2f", min((double) round(flySpeed * 100.0D) / 100.0D, 20.0D));
    }

    public static boolean isAtSpawn(Player player, int spawn_radius) {
        return (new Point(player.getLocation().getBlockX(), player.getLocation().getBlockZ()).distance(new Point(0, 0)) < spawn_radius);
    }

    public static boolean isOnNetherCeiling(Player player) {
        // 123 is the height where bedrock starts to generate on the ceiling. Prevents players from
        // creating ceiling highways for elytras by deleting bedrock. Does not affect normal nether highways.
        return (player.getWorld().getEnvironment().equals(World.Environment.NETHER) && player.getLocation().getY() > AnarchyExploitFixes.getConfiguration().nether_ceiling_max_y-4);
    }
}
